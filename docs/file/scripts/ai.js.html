<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../">
  <title data-ice="title">scripts/ai.js | gg_domtest</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
</head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  </ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">scripts/ai.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">/**
 * AI closure
 */
var AI = (function(){

    var obj = {}
    var selunit
    var turn = false

    return{

        setUnit: function(obj){
            selunit = obj
        },
        getUnit: function(){
            return selunit
        },
        setTurn: function(value){
            turn = value
        },
        getTurn: function(){
            return turn
        }

    }

})()

var intval_index = 0

/**
 * Main action for AI. This function gets called when the current player is AI
 */
function doAI(){

    var cur_team = game.selectedTeam
    var cur_unit
    intval_index = 0

    console.log(cur_team)

    //for(var i = 0; i &lt; cur_team.list.length; i++){

    executeTurn(cur_team.objects.get(cur_team.list[0]))

    var timer = setInterval(function(){
        console.log(&apos;interval!&apos;)

        if(intval_index &lt; cur_team.list.length){
            cur_unit = cur_team.objects.get(cur_team.list[intval_index])
            executeTurn(cur_unit)

            //intval_index++
        }else{
            interval_index = 0
            clearTimeout(timer);
            setTurn()
        }

    }, 500)

    //}

}

/**
 * Executes a series of actions for the current AI unit
 * @param {object} unit 
 */
function executeTurn(unit){

    console.log(&apos;--- Executing Turn ---&apos;)
    console.log(unit.dom)

    delIndicators()

    var current_unit = unit
    var targets = seekTarget(current_unit)
    var areas = createMoveArea(current_unit)

    console.log(areas)

    if(targets[&quot;in_range&quot;].length &gt; 0){
        attack(current_unit, targets[&quot;in_range&quot;][0][&quot;victim&quot;]);
    
    }else{
        var closest = getClosestMove(areas)
        console.log(closest)
        current_unit.move(closest.apcost, closest.area.tile.x, closest.area.tile.y)
    }

    if(unit.stats.moves &lt;= 0){
        intval_index++
    }    
}

/**
 * Pick the movement area that is closest to an enemy unit
 * @param {Array} areas 
 */
function getClosestMove(areas){
    var closest = 9999
    var distance = 0
    var closest_area

    for(var i = 0; i&lt;areas.length;i++){

        var curarea = areas[i]
        distance = Math.floor(getDistance(curarea.tile.px_x, curarea.tile.px_y, targets.not_in_range[0].victim.pxpos_x, targets.not_in_range[0].victim.pxpos_y,))

        curarea.innerText = distance

        if(distance &lt; closest){
            closest = distance
            closest_area = curarea
        }

    }

    return {&apos;area&apos;: closest_area, &apos;apcost&apos;: closest_area.apcost}
}</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.1.0)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
